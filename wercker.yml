box:
  id: ruby:latest
build:
  steps:
    - inokappa/rvm-install:
      version: 2.1.2
#    - rvm-use:
#      version: 2.1.2
    - script:
        name: echo ruby information
        code: |
          echo "ruby version $(ruby --version) running"
          echo "from location $(which ruby)"
          echo -p "gem list: $(gem list)"

deploy:
  steps:
#    - heroku-deploy:
#        heroku_key: HEROKU_KEY
#        key-name: HEROKU_KEY

    - add-to-known_hosts:
        hostname: $GIT_DEPLOY_HOST

    - add-ssh-key:
        keyname: DOKKU_KEY

    - script:
        name: push to dokku
        code: |
          echo "Pushing to: $GIT_DEPLOY_USER@$GIT_DEPLOY_HOST:$GIT_DEPLOY_APP"
          git remote add dokku $GIT_DEPLOY_USER@$GIT_DEPLOY_HOST:$GIT_DEPLOY_APP
          git push dokku HEAD:master -f


  after-steps:
    - email-notify:
        on: failed
        failed-subject: Grinfit deploy failed
        from: alerts@wercker.com
        to: grin@grin.io
        username: grinfit@m.grin.io
        password: $EMAIL_PASSWORD
        host: smtp.mailgun.org:587

